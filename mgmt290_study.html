<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MGMT 290 Exam Review</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Custom scrollbar for better feel */
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #a8a8a8;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f0f0f0; }

        /* Hide the options list initially in Study Mode */
        .study-options-hidden { display: none; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 md:p-8 flex items-center justify-center">

    <div id="app" class="w-full max-w-4xl bg-white shadow-2xl rounded-xl p-6 md:p-10 border border-gray-100 transition-all duration-500">
        </div>

    <script>
        // --- 1. DATA STRUCTURE: 110 Questions ---

        // Difficulty ranking: 1 (Easy: Definition/Recall), 2 (Medium: Application/Concept), 3 (Hard: Synthesis/Detailed Recall)
        const questionsData = [
            // Chapter 1
            { id: 1, chapter: "Chapter 1", difficulty: 2, question: "George burns a U.S. flag in his backyard. He films the activity and posts the video on YouTube.com. George’s conduct is most likely:", options: ["expressly prohibited by the Constitution.", "protected by the First Amendment.", "subject to reasonable restrictions under the due process clause.", "given strict scrutiny under the equal protection clause."], correctAnswer: "protected by the First Amendment." },
            { id: 2, chapter: "Chapter 1", difficulty: 2, question: "Courts often refer to secondary sources of law for guidance in interpreting and applying a primary source of law.", options: ["True", "False"], correctAnswer: "True" },
            { id: 3, chapter: "Chapter 1", difficulty: 2, question: "The members of Citizens Aware believe that a recently enacted federal law is unconstitutional. They write and sign a petition to the government to repeal the law, refuse to obey it, and stop others from complying with it. Under the First Amendment, these individuals have a right to:", options: ["petition the government.", "refuse to obey any law with which they disagree.", "stop others from complying with any law.", "none of the choices."], correctAnswer: "petition the government." },
            { id: 4, chapter: "Chapter 1", difficulty: 2, question: "A statute is a secondary source of law.", options: ["True", "False"], correctAnswer: "False" },
            { id: 5, chapter: "Chapter 1", difficulty: 2, question: "V-Games Inc. markets a variety of shooting, fighting, and hunting video games. A state statute is enacted to require all game makers to label any games with an option to kill something as “excessively violent.” A court would likely hold this regulation to be:", options: ["an unconstitutional restriction of speech.", "constitutional under the First Amendment.", "justified by the need to protect individual rights.", "necessary to protect national interests."], correctAnswer: "an unconstitutional restriction of speech." },
            { id: 6, chapter: "Chapter 1", difficulty: 2, question: "A constitution is a primary source of law.", options: ["True", "False"], correctAnswer: "True" },
            { id: 7, chapter: "Chapter 1", difficulty: 2, question: "Even if it conflicts with the U.S. Constitution, a state constitution is supreme within that state’s borders.", options: ["True", "False"], correctAnswer: "False" },
            { id: 8, chapter: "Chapter 1", difficulty: 2, question: "A precedent is:", options: ["the chief executive officer of the United States.", "a court decision that furnishes an example for deciding subsequent cases involving similar or identical facts or principles.", "a lawsuit in which a number of persons join together.", "the fundamental procedure by which the government exercises its authority."], correctAnswer: "a court decision that furnishes an example for deciding subsequent cases involving similar or identical facts or principles." },
            { id: 9, chapter: "Chapter 1", difficulty: 2, question: "A law that limits a fundamental right may be held to violate substantive due process.", options: ["True", "False"], correctAnswer: "True" },
            { id: 10, chapter: "Chapter 1", difficulty: 2, question: "The Uniform Commercial Code facilitates commerce:", options: ["among the states.", "between the states and the federal government.", "in countries that were once colonies of Great Britain.", "in international markets."], correctAnswer: "among the states." },

            // Chapter 2
            { id: 11, chapter: "Chapter 2", difficulty: 2, question: "In a suit by Citizens Conservation Organization (CCO) against Deep Mining Inc., CCO serves a written request for the defendant to admit the truth of matters relating to the trial. Deep Mining’s admission in response:", options: ["conclusively establishes the matter for trial.", "completely absolves the defendant of the issue in question.", "is the basis for a default judgment in the plaintiff’s favor.", "is irrelevant."], correctAnswer: "conclusively establishes the matter for trial." },
            { id: 12, chapter: "Chapter 2", difficulty: 2, question: "D’Antoni files a suit in a federal district court against Enya. D’Antoni loses the suit, appeals to the U.S. Court of Appeals for the Ninth Circuit, and loses again. D’Antoni asks the United States Supreme Court to hear the case. The Court is:", options: ["not required to hear the case.", "required to hear the case because D’Antoni lost in a federal court.", "required to hear the case because D’Antoni lost in a lower court.", "required to hear the case because it is an appeal."], correctAnswer: "not required to hear the case." },
            { id: 13, chapter: "Chapter 2", difficulty: 2, question: "State trial courts that are called special inferior trial courts or minor judiciary courts are most likely to have:", options: ["appellate jurisdiction.", "general jurisdiction.", "limited jurisdiction.", "no jurisdiction."], correctAnswer: "limited jurisdiction." },
            { id: 14, chapter: "Chapter 2", difficulty: 2, question: "In a case based on diversity of citizenship, a federal court will apply the relevant state law.", options: ["True", "False"], correctAnswer: "True" },
            { id: 15, chapter: "Chapter 2", difficulty: 2, question: "Negotiation requires the use of a neutral third party to facilitate a settlement.", options: ["True", "False"], correctAnswer: "False" },
            { id: 16, chapter: "Chapter 2", difficulty: 2, question: "Jurors must decide a case based only on the information that they learn during the trial.", options: ["True", "False"], correctAnswer: "True" },
            { id: 17, chapter: "Chapter 2", difficulty: 2, question: "Shippers Warehouse initiates a suit against Trans-State Trucking (TST) by filing a complaint. If TST files a motion to dismiss, the firm is asserting that:", options: ["even if the facts in the complaint are true, TST is not legally liable.", "the facts in the complaint are not true.", "even if TST is legally liable, Shippers Warehouse cannot prove it.", "if the facts are true, Shippers Warehouse has a right to judicial relief."], correctAnswer: "even if the facts in the complaint are true, TST is not legally liable." },
            { id: 18, chapter: "Chapter 2", difficulty: 2, question: "Cattle House Steaks, an Alabama company, enters into a contract over the phone with Beef Packing Inc., an out-of-state corporation. If a dispute arises, an Alabama court can exercise jurisdiction over Beef Packing:", options: ["under the minimum contacts test.", "on the basis of a federal question.", "in no circumstances.", "only if Beef Packing files the suit."], correctAnswer: "under the minimum contacts test." },
            { id: 19, chapter: "Chapter 2", difficulty: 2, question: "Grain Farms, Inc., files a suit against Harvest Services. Before the court can exercise jurisdiction over Harvest, the court must have proof that:", options: ["Grain Farms is prepared to notify Harvest of the suit.", "Grain Farms did not act to precipitate a dispute with Harvest.", "Harvest committed the act of which Grain Farms complains.", "Harvest was notified of the suit."], correctAnswer: "Harvest was notified of the suit." },
            { id: 20, chapter: "Chapter 2", difficulty: 2, question: "Petro Fuel files a suit in a state court against Quality Gas. Before the trial, Petro requests from Quality relevant information stored electronically. In contrast to traditional discovery, this request can legitimately reveal:", options: ["privileged or confidential material.", "metadata.", "information to which Petro would otherwise be denied access by the right to privacy.", "all of the choices."], correctAnswer: "metadata." },

            // Chapter 3
            { id: 21, chapter: "Chapter 3", difficulty: 2, question: "The effectiveness of an industry code of ethics is partly determined by the commitment of the industry or company leadership to enforce it.", options: ["True", "False"], correctAnswer: "True" },
            { id: 22, chapter: "Chapter 3", difficulty: 2, question: "When adopting duty-based ethics, corporations often demonstrate the duties they owe:", options: ["through required government disclosure forms.", "in their mission statements and strategic plans.", "by adopting a corporate religion.", "in the biographies of corporate leaders."], correctAnswer: "in their mission statements and strategic plans." },
            { id: 23, chapter: "Chapter 3", difficulty: 2, question: "The term moral minimum is best defined as the highest degree of ethical behavior expected of a firm.", options: ["True", "False"], correctAnswer: "False" },
            { id: 24, chapter: "Chapter 3", difficulty: 2, question: "Company codes of conduct set forth company policies and expectations for different issues.", options: ["True", "False"], correctAnswer: "True" },
            { id: 25, chapter: "Chapter 3", difficulty: 2, question: "Conduct that is legal is ethically unquestionable.", options: ["True", "False"], correctAnswer: "False" },
            { id: 26, chapter: "Chapter 3", difficulty: 2, question: "One view of the role of business in society is the perceived duty of a company only to generate revenue for its owners.", options: ["True", "False"], correctAnswer: "True" },
            { id: 27, chapter: "Chapter 3", difficulty: 2, question: "It can be difficult to predict with certainty how a court will apply a given law to a particular action.", options: ["True", "False"], correctAnswer: "True" },
            { id: 28, chapter: "Chapter 3", difficulty: 2, question: "Under the principle of rights theory, the key factor in a decision is how the result may harm the rights of the company to make money.", options: ["True", "False"], correctAnswer: "False" },
            { id: 29, chapter: "Chapter 3", difficulty: 2, question: "Because it may be unclear how a court will interpret and apply a law, companies can ensure decisions are viewed as ethical by documenting their own interpretation of the law.", options: ["True", "False"], correctAnswer: "False" },
            { id: 30, chapter: "Chapter 3", difficulty: 2, question: "The National Restaurant Association announces a new industry code of ethics. The effectiveness of this code will be determined by:", options: ["the commitment of management to enforcing the code.", "the similarity of the code to the employees’ personal values.", "the success of the campaign publicizing the code.", "the relationship between the code and the law."], correctAnswer: "the commitment of management to enforcing the code." },

            // Chapter 4
            { id: 31, chapter: "Chapter 4", difficulty: 2, question: "Attributing to a person an act of misconduct not actually perpetrated by that person can be the basis of liability in an action for invasion of privacy.", options: ["True", "False"], correctAnswer: "True" },
            { id: 32, chapter: "Chapter 4", difficulty: 2, question: "Buddy’s Burgers advertises so effectively that the regular customers of its competitor Slimy’s Sliders patronize Buddy’s instead of Slimy’s. This is:", options: ["conversion.", "wrongful interference with a business relationship.", "wrongful interference with a contractual relationship.", "none of the choices."], correctAnswer: "none of the choices." },
            { id: 33, chapter: "Chapter 4", difficulty: 2, question: "A person who wrongfully hurts another’s good name or reputation orally may be liable for libel.", options: ["True", "False"], correctAnswer: "False" },
            { id: 34, chapter: "Chapter 4", difficulty: 2, question: "Without Data Corporation’s consent, Elias hacks into the firm’s computers and downloads trade secrets and other confidential information. Most likely, Elias is liable for the tort of:", options: ["trespass to land.", "conversion.", "appropriation.", "battery."], correctAnswer: "conversion." },
            { id: 35, chapter: "Chapter 4", difficulty: 2, question: "Foreseeability is the test for proximate cause.", options: ["True", "False"], correctAnswer: "True" },
            { id: 36, chapter: "Chapter 4", difficulty: 2, question: "Ricard, an engineer, supervises the construction of a new mountainside roadway. The road collapses in a landslide due to faulty grading. Motorists injured in the collapse sue Ricard in a tort action for negligence. Under that theory, as a professional, Ricard is held to the same standard of care as:", options: ["ordinary persons.", "other engineers.", "other professionals, including doctors, dentists, and lawyers.", "those injured in the collapse of the bridge."], correctAnswer: "other engineers." },
            { id: 37, chapter: "Chapter 4", difficulty: 2, question: "In a product liability suit based on a design defect, a manufacturer is liable only when the harm was not reasonably preventable.", options: ["True", "False"], correctAnswer: "False" },
            { id: 38, chapter: "Chapter 4", difficulty: 2, question: "Lyn is injured when a part of a building ledge breaks free and strikes her. If Lyn brings a successful tort action against the building’s owner, she may be awarded special damages to compensate her for:", options: ["monetary losses, such as medical expenses.", "nonmonetary aspects of the harm suffered, such as pain and suffering.", "egregious or reprehensible conduct by the defendant.", "all of the choices."], correctAnswer: "monetary losses, such as medical expenses." },
            { id: 39, chapter: "Chapter 4", difficulty: 2, question: "A defendant cannot be liable for negligence unless he or she intended to harm the plaintiff.", options: ["True", "False"], correctAnswer: "False" },
            { id: 40, chapter: "Chapter 4", difficulty: 2, question: "Mai is struck and injured when the brakes fail on Novi’s all-terrain vehicle (ATV), which is damaged in the collision. Off-Road Inc. sold the ATV to Novi. Under product liability laws, Off-Road could be liable to:", options: ["Novi, but not Mai.", "Mai, but not Novi.", "none of the parties.", "Mai and Novi."], correctAnswer: "Mai and Novi." },

            // Chapter 5
            { id: 41, chapter: "Chapter 5", difficulty: 2, question: "Organos Ltd. traffics in nutritional supplements that are marketed as genuine, trademark-branded products when in fact they are counterfeit. This is a crime:", options: ["only if the counterfeits have negative effects on legitimate businesses.", "only if the counterfeits present serious public health risks.", "under all circumstances.", "under no circumstances."], correctAnswer: "under all circumstances." },
            { id: 42, chapter: "Chapter 5", difficulty: 2, question: "O-Ring Corporation allows Piston Company to incorporate O-Ring’s patented fuel-injection system into Piston’s product. This is:", options: ["a license.", "copyright infringement.", "trademark infringement.", "patent infringement."], correctAnswer: "a license." },
            { id: 43, chapter: "Chapter 5", difficulty: 2, question: "Graphix S.A. traffics in labels that bear counterfeit trademarks. This is a crime:", options: ["only if the labels have negative effects on legitimate businesses.", "only if the labels are attached to counterfeit goods.", "under all circumstances.", "under no circumstances."], correctAnswer: "under all circumstances." },
            { id: 44, chapter: "Chapter 5", difficulty: 2, question: "Arbitrary and fanciful trademarks are sometimes considered to be the most distinctive trademarks.", options: ["True", "False"], correctAnswer: "True" },
            { id: 45, chapter: "Chapter 5", difficulty: 2, question: "Like most successful companies, Phones Inc. has trade secrets. The law protects those secrets if the information is:", options: ["not revealed to outside parties.", "cataloged by the company as “confidential.”", "useful and is in fact used by the company.", "of value to a competitor."], correctAnswer: "of value to a competitor." },
            { id: 46, chapter: "Chapter 5", difficulty: 2, question: "Service marks are not protected in the same way as trademarks.", options: ["True", "False"], correctAnswer: "False" },
            { id: 47, chapter: "Chapter 5", difficulty: 2, question: "Obtaining a court order to close down the domain name of a website is an effective tool that U.S. officials use to combat online sales of:", options: ["licenses.", "counterfeit goods.", "competing products.", "trademarks."], correctAnswer: "counterfeit goods." },
            { id: 48, chapter: "Chapter 5", difficulty: 2, question: "Serena invents a new, unique, long-life battery. A grant from the government that gives Serena the exclusive right to make and sell the battery for a certain period of time is:", options: ["a patent.", "a trademark.", "a copyright.", "a trade secret."], correctAnswer: "a patent." },
            { id: 49, chapter: "Chapter 5", difficulty: 2, question: "A trademark owner that successfully proves infringement can recover the profits that the infringer wrongfully received from the infringement.", options: ["True", "False"], correctAnswer: "True" },
            { id: 50, chapter: "Chapter 5", difficulty: 2, question: "Some business processes can be protected as trade secrets.", options: ["True", "False"], correctAnswer: "True" },

            // Chapter 6
            { id: 51, chapter: "Chapter 6", difficulty: 2, question: "Any party who gives information to the Federal Trade Commission concerning possible deceptive conduct in a foreign jurisdiction is immune from liability.", options: ["True", "False"], correctAnswer: "True" },
            { id: 52, chapter: "Chapter 6", difficulty: 2, question: "BeFriends Corporation uses the trademark of Community Life Inc., a social media site, as a meta tag without Community Life’s permission. This may be permissible:", options: ["if the appropriating site has nothing to do with the meta tag.", "if the two sites appear in the same search engine results.", "if the use constitutes trademark infringement.", "in none of these circumstances."], correctAnswer: "in none of these circumstances." },
            { id: 53, chapter: "Chapter 6", difficulty: 2, question: "Volatile Investments Inc. sends e-mail ads to any e-mail address that the sender can find on the Web or otherwise generate. Under federal law, Volatile’s marketing method:", options: ["may be permitted.", "is prohibited.", "must be reviewed by a federal agency.", "is preempted."], correctAnswer: "may be permitted." },
            { id: 54, chapter: "Chapter 6", difficulty: 2, question: "Criminal liability for the piracy of copyrighted materials extends only to persons who exchange unauthorized copies for profit.", options: ["True", "False"], correctAnswer: "False" },
            { id: 55, chapter: "Chapter 6", difficulty: 2, question: "Mix Restaurant Corporation owns the trademark “Mix.” Remix Café Company begins to use the mark without authorization as a domain name. Mix files a suit against Remix on a theory of trademark dilution. This claim requires proof that:", options: ["none of the choices.", "consumers are likely to be confused by the names.", "the products involved are similar.", "Mix has registered all variations of the name “Mix.”"], correctAnswer: "none of the choices." },
            { id: 56, chapter: "Chapter 6", difficulty: 2, question: "A social media post cannot be used to invalidate a settlement agreement.", options: ["True", "False"], correctAnswer: "False" },
            { id: 57, chapter: "Chapter 6", difficulty: 2, question: "Prodigious Profit, LLC, and other companies operate social media websites, issue apps for mobile devices, obtain ad revenue from search engines, and sell directly to consumers from other sites. The privacy rights of the users of these products are frequently defined, not by the courts or legislatures, but by:", options: ["the companies that own the sites and the apps.", "retailers who have had to change their procedures to compete.", "spammers, cybersquatters, and typosquatters.", "Internet service providers."], correctAnswer: "the companies that own the sites and the apps." },
            { id: 58, chapter: "Chapter 6", difficulty: 2, question: "A license may limit the use of a software application to a specific device.", options: ["True", "False"], correctAnswer: "True" },
            { id: 59, chapter: "Chapter 6", difficulty: 2, question: "Flash Inc., a maker of athletic shoes, registers and uses “flash” as its domain name. Later, Got Shoes Company begins to use “flast” (an intentional misspelling of “flash”) as its domain name. Got Shoes is most likely:", options: ["diminishing the quality of Flash’s mark.", "making a fair use of Flash’s mark.", "licensing the use of Flash’s mark to itself.", "engaging in lawful competitive conduct."], correctAnswer: "diminishing the quality of Flash’s mark." },
            { id: 60, chapter: "Chapter 6", difficulty: 2, question: "Without authorization, Ben uses the trademark of Cielo Coffee Company to promote cheap, flavorless candy, which is not similar to Cielo’s products but diminishes the quality of the coffee company’s mark. This is:", options: ["cybersquatting.", "typosquatting.", "trademark infringement.", "trademark dilution."], correctAnswer: "trademark dilution." },

            // Chapter 7
            { id: 61, chapter: "Chapter 7", difficulty: 2, question: "A corporation can refuse to produce business records that might subject the firm to criminal prosecution.", options: ["True", "False"], correctAnswer: "False" },
            { id: 62, chapter: "Chapter 7", difficulty: 2, question: "Most crimes require an act of commission.", options: ["True", "False"], correctAnswer: "True" },
            { id: 63, chapter: "Chapter 7", difficulty: 2, question: "Don sends an e-mail to Eve, promising her a percentage of the amount in a foreign bank account if she will assist in transferring the funds to a U.S. bank account. Eve forwards her account number, but the funds are never sent. Instead, Don quickly withdraws the funds in Eve’s account. This is:", options: ["no crime.", "identity theft.", "phishing.", "hacking."], correctAnswer: "phishing." },
            { id: 64, chapter: "Chapter 7", difficulty: 2, question: "The U.S. Constitution provides safeguards that apply not only in federal but also in state courts.", options: ["True", "False"], correctAnswer: "True" },
            { id: 65, chapter: "Chapter 7", difficulty: 2, question: "A person who accesses a computer online without authority to obtain protected data is subject to criminal prosecution.", options: ["True", "False"], correctAnswer: "True" },
            { id: 66, chapter: "Chapter 7", difficulty: 2, question: "A statute that prohibits theft by means of false pretenses usually applies only to goods, not to services or cash.", options: ["True", "False"], correctAnswer: "False" },
            { id: 67, chapter: "Chapter 7", difficulty: 2, question: "The Computer Access Device and Computer Fraud and Abuse Act prohibits cyber theft.", options: ["True", "False"], correctAnswer: "True" },
            { id: 68, chapter: "Chapter 7", difficulty: 2, question: "Fraudulent appropriation of another’s property with which a person has been entrusted is the crime of receiving stolen goods.", options: ["True", "False"], correctAnswer: "False" },
            { id: 69, chapter: "Chapter 7", difficulty: 2, question: "Sam, driving under the influence, causes a car accident that results in the death of Tanya. Sam is arrested and charged with a crime punishable by imprisonment for more than a year. This crime is:", options: ["a misdemeanor.", "a felony.", "a civil wrong.", "a tort."], correctAnswer: "a felony." },
            { id: 70, chapter: "Chapter 7", difficulty: 2, question: "Via the Internet, Britta enters false code into the computer control system of Chicken Company, a food maker, to alter the levels of ingredients so that consumers of the food become ill. Britta is:", options: ["a cyberterrorist.", "a phisher.", "malware.", "a prosecutor."], correctAnswer: "a cyberterrorist." },

            // Chapter 8
            { id: 71, chapter: "Chapter 8", difficulty: 2, question: "Fresh Agro Inc. offers to deliver produce to Growers’ Market for a certain price. Fresh’s intent to extend an offer is determined by reference to Fresh’s:", options: ["market assumptions.", "all of the choices.", "subjective, unexpressed intentions.", "words and actions."], correctAnswer: "words and actions." },
            { id: 72, chapter: "Chapter 8", difficulty: 2, question: "If a person expresses contract terms with such uncertainty that the terms are not definite, the promise is illusory but the deal is enforceable.", options: ["True", "False"], correctAnswer: "False" },
            { id: 73, chapter: "Chapter 8", difficulty: 2, question: "Marketing Inc. offers to create a campaign to increase N’Ice Cream Inc.’s online business. N’Ice agrees to pay for the service. These parties have:", options: ["no contract.", "an express contract.", "an implied contract.", "a quasi contract."], correctAnswer: "an express contract." },
            { id: 74, chapter: "Chapter 8", difficulty: 2, question: "A contract is an implied contract if the conduct of the parties creates and defines some of the terms.", options: ["True", "False"], correctAnswer: "True" },
            { id: 75, chapter: "Chapter 8", difficulty: 2, question: "Putting up an item for sale on an online auction site is an offer.", options: ["True", "False"], correctAnswer: "False" },
            { id: 76, chapter: "Chapter 8", difficulty: 2, question: "An offer must express reasonably definite terms to be effective—no term may be reasonably inferred.", options: ["True", "False"], correctAnswer: "False" },
            { id: 77, chapter: "Chapter 8", difficulty: 2, question: "Larry advertises a reward for the return of his lost dog. Miguel does not learn of the reward, but finds and returns the dog. With respect to Miguel, Larry’s ad is not an offer because it lacks the element of:", options: ["communication.", "definite terms.", "serious intent.", "none of the choices."], correctAnswer: "communication." },
            { id: 78, chapter: "Chapter 8", difficulty: 2, question: "For the doctrine of promissory estoppel to be applied, there must be a clear and definite promise.", options: ["True", "False"], correctAnswer: "True" },
            { id: 79, chapter: "Chapter 8", difficulty: 2, question: "Red offers to pay Sara to deliver certain documents within thirty minutes. Sara can accept the offer only by completing the task within the deadline. If she does, Red and Sara will have:", options: ["a bilateral contract.", "a unilateral contract.", "a void contract.", "an executive contract."], correctAnswer: "a unilateral contract." },
            { id: 80, chapter: "Chapter 8", difficulty: 2, question: "Rejection of an offer is effective only when it is actually received.", options: ["True", "False"], correctAnswer: "True" },

            // Chapter 9
            { id: 81, chapter: "Chapter 9", difficulty: 2, question: "Lee, a minor, enters into a contract to buy a dirt bike from Motor Bikes & Cycles. Lee can ordinarily disaffirm the contract:", options: ["in a timely manner.", "at any time during minority.", "for a reasonable time after coming of age.", "all of the choices."], correctAnswer: "all of the choices." },
            { id: 82, chapter: "Chapter 9", difficulty: 2, question: "A party who can show that he or she did not genuinely agree to the terms of a contract can still choose to carry out the deal.", options: ["True", "False"], correctAnswer: "True" },
            { id: 83, chapter: "Chapter 9", difficulty: 2, question: "County Title Company processes information furnished by others to transfer title to real estate from a seller to a buyer. In performing this task for a sale of land from Dale to Ezra, the furnished information is mistaken. The contract between Dale and Ezra that includes the mistake may be rescinded because the mistake:", options: ["is about a material fact.", "concerns a term in the contract subject to only one interpretation.", "involves a detail on which the parties had a true “meeting of the minds.”", "affects County Title, a third party."], correctAnswer: "is about a material fact." },
            { id: 84, chapter: "Chapter 9", difficulty: 2, question: "In the context of fraudulent misrepresentation, an opinion is objective and verifiable, whereas a fact is subject to debate.", options: ["True", "False"], correctAnswer: "False" },
            { id: 85, chapter: "Chapter 9", difficulty: 2, question: "Car Lot’s salesperson Dick offers to sell Ernie, who is twenty years old, a car. Dick intentionally misrepresents the vehicle’s use and repairs. In reliance, Ernie buys the car. To prove fraud, Ernie does not have to show that:", options: ["Dick intentionally deceived Ernie.", "Dick misrepresented material facts.", "Ernie is under twenty-one.", "Ernie justifiably relied on Dick’s misrepresentations."], correctAnswer: "Ernie is under twenty-one." },
            { id: 86, chapter: "Chapter 9", difficulty: 2, question: "Main St. Market Inc. and Natural Food Corporation discuss the terms of a contract. They exchange “signed” e-mails that summarize the terms on which they agree. Between these parties, the e-mails are:", options: ["an oral contract.", "a pre-contract.", "a written contract.", "no contract."], correctAnswer: "a written contract." },
            { id: 87, chapter: "Chapter 9", difficulty: 2, question: "The Statute of Frauds operates as a defense to the enforcement of an oral contract for the sale of land.", options: ["True", "False"], correctAnswer: "True" },
            { id: 88, chapter: "Chapter 9", difficulty: 2, question: "To disaffirm a contract is to deny its existence.", options: ["True", "False"], correctAnswer: "False" },
            { id: 89, chapter: "Chapter 9", difficulty: 2, question: "Sal is mentally incompetent but has not been adjudged by a court to be incompetent. Sal enters into a contract with Tony for the cleaning and maintenance of Uptown Office building. Most likely, the contract is:", options: ["voidable if Sal did not comprehend the consequences.", "enforceable if Tony did not know that Sam was mentally incompetent.", "enforceable if Sam is the owner of the building.", "void."], correctAnswer: "voidable if Sal did not comprehend the consequences." },
            { id: 90, chapter: "Chapter 9", difficulty: 2, question: "Generally neither party to an illegal contract can sue for breach.", options: ["True", "False"], correctAnswer: "True" },

            // Chapter 10
            { id: 91, chapter: "Chapter 10", difficulty: 2, question: "Inez hires Josh to paint her portrait to her satisfaction for $4,000. When Josh finishes the portrait, Inez announces that she is not satisfied with it. Inez:", options: ["must pay Josh the contract price.", "must pay Josh half of the contract price as a compromise.", "must pay Josh only the cost of his materials.", "does not have to pay Josh."], correctAnswer: "does not have to pay Josh." },
            { id: 92, chapter: "Chapter 10", difficulty: 2, question: "Leah and Mason are parties to a contract for the sale of Mason’s day care facility to Leah. Before the deal closes, they agree to substitute Nell for Leah as a party to the deal. This does not require:", options: ["the existence of a previous, valid obligation.", "agreement by all the parties to a new contract.", "performance of the original contract by all of the parties.", "a new, valid contract."], correctAnswer: "performance of the original contract by all of the parties." },
            { id: 93, chapter: "Chapter 10", difficulty: 2, question: "East Bay Café orders seafood from Fresh Catch Company. Fresh places the goods at East’s disposal. Fresh’s performance under the contract is:", options: ["conditional.", "complete.", "material.", "substantial."], correctAnswer: "complete." },
            { id: 94, chapter: "Chapter 10", difficulty: 2, question: "Daisy enters into a contract with Evan for the construction of a Fast Food Café, according to a certain schedule. The parties perform some preparatory steps, but Evan materially and willfully fails to begin work on the specified date. To rescind the contract, Daisy must show that the parties can:", options: ["be restored to the status quo.", "realize at least some of the benefit of their bargain.", "obtain a reasonable exchange of values for the preparatory steps.", "profit from the partial performance."], correctAnswer: "be restored to the status quo." },
            { id: 95, chapter: "Chapter 10", difficulty: 2, question: "Erma enters into a contract to buy a tract of lakefront property from Forest Acres to build and sell a residential development. Forest Acres fails to close the sale. Erma’s remedy is most likely:", options: ["the amount that Erma invested in the project to the date of the closing.", "nothing—Forest Acres still owns the land.", "the difference between the contract and market prices of the land.", "specific performance."], correctAnswer: "specific performance." },
            { id: 96, chapter: "Chapter 10", difficulty: 2, question: "A buyer who offers to pay for goods has tendered payment but cannot yet demand delivery.", options: ["True", "False"], correctAnswer: "False" },
            { id: 97, chapter: "Chapter 10", difficulty: 2, question: "A seller who places goods at the disposal of a buyer has tendered delivery but cannot yet demand payment.", options: ["True", "False"], correctAnswer: "False" },
            { id: 98, chapter: "Chapter 10", difficulty: 2, question: "If performance of a contract is not substantial, there is a material breach, which excuses the innocent, non-breaching party from performance.", options: ["True", "False"], correctAnswer: "True" },
            { id: 99, chapter: "Chapter 10", difficulty: 2, question: "An accord and its satisfaction do not discharge an original contractual obligation.", options: ["True", "False"], correctAnswer: "False" },
            { id: 100, chapter: "Chapter 10", difficulty: 2, question: "The first element of proving fraud is to show that the innocent party is not easily fooled.", options: ["True", "False"], correctAnswer: "False" },

            // Chapter 11
            { id: 101, chapter: "Chapter 11", difficulty: 2, question: "Safety Insurance Agency contracts with Town Motors to buy six cars. The contract lists the cars by their VINs (vehicle identification numbers). Under the UCC, identification:", options: ["requires the filing of a copy of the contract in the appropriate state office.", "has taken place.", "cannot take place unless the cars are in Town’s possession.", "cannot take place until the cars are in Safety’s possession."], correctAnswer: "has taken place." },
            { id: 102, chapter: "Chapter 11", difficulty: 2, question: "Barley that fills County Grain Co-op’s silo is fungible if the barley is:", options: ["alike naturally, by agreement, or by trade usage.", "fundamentally different.", "fun, good, and edible.", "rotting due to a fungus caused by a leaky roof and a delay in shipping."], correctAnswer: "alike naturally, by agreement, or by trade usage." },
            { id: 103, chapter: "Chapter 11", difficulty: 2, question: "The UCC provides that a sale or lease contract will fail for indefiniteness if more than one of its terms is left open.", options: ["True", "False"], correctAnswer: "False" },
            { id: 104, chapter: "Chapter 11", difficulty: 2, question: "The UCC promotes commerce by simplifying and streamlining commercial transactions.", options: ["True", "False"], correctAnswer: "True" },
            { id: 105, chapter: "Chapter 11", difficulty: 2, question: "Greg buys a skateboard from Hobby Shop. In a dispute arising from the sale, the shop will be considered to have the status of a merchant under the UCC if:", options: ["it has sold any skateboards within the last year.", "it holds itself out by occupation as having knowledge and skill unique to the skateboard in the transaction.", "its owner enjoys skateboarding.", "it subscribes to Boards, a biweekly trade magazine."], correctAnswer: "it holds itself out by occupation as having knowledge and skill unique to the skateboard in the transaction." },
            { id: 106, chapter: "Chapter 11", difficulty: 2, question: "Jake offers to sell Kyle a collection of baseball cards. To qualify as a sale under the UCC, Kyle’s payment for the cards must be:", options: ["split into more than one installment.", "in cash, or its equivalent, or in other goods or services.", "specified on an invoice and evidenced by a receipt.", "the fair market value of the goods."], correctAnswer: "in cash, or its equivalent, or in other goods or services." },
            { id: 107, chapter: "Chapter 11", difficulty: 2, question: "Grass Farm LLC offers to sell fifty bales of hay at a certain price to Horse Stable Inc. The owner of the stable responds, “We agree if you agree to make it sixty bales for the price.” Their contract is formed according to:", options: ["the new terms of the acceptance.", "whatever is reasonable.", "the terms of the original offer.", "none of the terms."], correctAnswer: "none of the terms." },
            { id: 108, chapter: "Chapter 11", difficulty: 2, question: "Appliance Corporation sells Best-brand vacuum cleaners to Cash Discount Stores and other retailers. Appliance will have an insurable interest in the vacuums as long as:", options: ["Appliance remains in business.", "Appliance retains title to the goods.", "the goods are in existence.", "there is no risk of loss."], correctAnswer: "Appliance retains title to the goods." },
            { id: 109, chapter: "Chapter 11", difficulty: 2, question: "United Wear Inc. and Winter Gear stores enter into a contract for a sale of coats. Their contract can indicate that the price includes transportation costs to a specific destination by including the term:", options: ["C.I.F.", "delivery ex-ship.", "F.A.S.", "F.O.B."], correctAnswer: "F.O.B." },
            { id: 110, chapter: "Chapter 11", difficulty: 2, question: "Clean Clinic offers to buy from Dental Supplies Company a specific quantity of a certain type of floss for a stated price. Dental can accept the offer by:", options: ["a material alteration of the terms within a reasonable time.", "a promise to ship or a prompt shipment of the goods.", "a prompt shipment of the goods only.", "a promise to ship only."], correctAnswer: "a promise to ship or a prompt shipment of the goods." }
        ];


        // --- 2. APP STATE MANAGEMENT & INITIALIZATION ---
        
        let appState = {
            view: 'home', // 'home', 'quiz', 'results', 'studySetup', 'studyMode'
            mode: null, // 'test', 'quiz', or 'study'
            currentQuestionIndex: 0,
            currentQuestionList: [],
            userAnswers: [],
            feedbackMessage: null,
            correctAnswer: null,
            selectedOption: null,
            isAnswered: false,
            // Study Mode filters
            studyFilters: {
                chapters: ['Chapter 1', 'Chapter 2', 'Chapter 3', 'Chapter 4', 'Chapter 5', 'Chapter 6', 'Chapter 7', 'Chapter 8', 'Chapter 9', 'Chapter 10', 'Chapter 11'],
                difficulties: [1, 2, 3]
            },
            // NEW: History of the last 10 quiz attempts (array of arrays of question IDs)
            quizHistory: [],
        };

        const appContainer = document.getElementById('app');
        const HISTORY_KEY = 'fin218_quiz_history';
        const MAX_HISTORY_ATTEMPTS = 10;

        /**
         * Loads quiz history from localStorage on startup.
         */
        function initializeAppState() {
            const historyString = localStorage.getItem(HISTORY_KEY);
            try {
                const loadedHistory = historyString ? JSON.parse(historyString) : [];
                // Ensure loaded data is an array before assigning
                appState.quizHistory = Array.isArray(loadedHistory) ? loadedHistory : [];
            } catch (e) {
                console.error("Error loading quiz history from localStorage:", e);
                appState.quizHistory = [];
            }
        }
        
        /**
         * Saves the current quiz IDs to history and prunes the list to MAX_HISTORY_ATTEMPTS.
         */
        function saveQuizHistory() {
            const currentQuizIds = appState.currentQuestionList.map(q => q.id);
            
            // Add the new quiz to the history
            appState.quizHistory.push(currentQuizIds);
            
            // Trim the history to the last 10 attempts
            if (appState.quizHistory.length > MAX_HISTORY_ATTEMPTS) {
                appState.quizHistory = appState.quizHistory.slice(-MAX_HISTORY_ATTEMPTS);
            }
            
            // Save back to localStorage
            try {
                localStorage.setItem(HISTORY_KEY, JSON.stringify(appState.quizHistory));
            } catch (e) {
                console.error("Error saving quiz history to localStorage:", e);
            }
        }


        // --- 3. HELPER FUNCTIONS ---

        // Utility to shuffle an array (used for Quiz Mode)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // --- 4. CORE LOGIC (Test/Quiz Modes) ---

        function startMode(mode) {
            appState.mode = mode;
            appState.userAnswers = [];
            appState.currentQuestionIndex = 0;
            appState.feedbackMessage = null;
            appState.correctAnswer = null;
            appState.selectedOption = null;
            appState.isAnswered = false;

            if (mode === 'test') {
                appState.currentQuestionList = [...questionsData];
                shuffleArray(appState.currentQuestionList);
            } else if (mode === 'quiz') {
                const QUIZ_SIZE = 10;
                
                // 1. Consolidate all IDs from the last N attempts (up to 10)
                // flat() merges all nested arrays (each quiz attempt) into a single array of IDs
                const recentlyUsedIds = appState.quizHistory.flat(); 
                
                // 2. Separate questions into 'unseen' (not in consolidated history) and 'seen'
                const unseenQuestions = questionsData.filter(q => !recentlyUsedIds.includes(q.id));
                const seenQuestions = questionsData.filter(q => recentlyUsedIds.includes(q.id));

                // 3. Shuffle both pools
                shuffleArray(unseenQuestions);
                shuffleArray(seenQuestions);

                // 4. Prioritize 'unseen' questions
                let selectedQuestions = [];
                
                // Take as many 'unseen' questions as available, up to QUIZ_SIZE
                const unseenToTake = Math.min(unseenQuestions.length, QUIZ_SIZE);
                selectedQuestions.push(...unseenQuestions.slice(0, unseenToTake));

                // 5. Fill remaining slots with 'seen' questions if necessary
                const remainingSlots = QUIZ_SIZE - selectedQuestions.length;
                if (remainingSlots > 0) {
                    selectedQuestions.push(...seenQuestions.slice(0, remainingSlots));
                }

                // 6. Final check and shuffle
                shuffleArray(selectedQuestions);
                appState.currentQuestionList = selectedQuestions;

            }

            appState.view = 'quiz'; // Reusing the quiz view for test/quiz mode
            render();
        }

        function checkAnswer(selectedOption) {
            if (appState.isAnswered) return; // Prevent double answering

            const currentQ = appState.currentQuestionList[appState.currentQuestionIndex];
            const isCorrect = (selectedOption === currentQ.correctAnswer);

            appState.selectedOption = selectedOption;
            appState.correctAnswer = currentQ.correctAnswer;
            appState.isAnswered = true;

            if (isCorrect) {
                appState.feedbackMessage = "Correct!";
            } else {
                appState.feedbackMessage = "Incorrect. The correct answer is:";
            }

            // Record the answer for final grading
            appState.userAnswers.push({
                questionId: currentQ.id,
                userAnswer: selectedOption,
                correct: isCorrect
            });

            render();
        }

        function nextQuestion() {
            if (!appState.isAnswered) {
                return;
            }

            appState.currentQuestionIndex++;
            appState.feedbackMessage = null;
            appState.correctAnswer = null;
            appState.selectedOption = null;
            appState.isAnswered = false;

            if (appState.currentQuestionIndex >= appState.currentQuestionList.length) {
                // Save quiz history before showing results (only for 'quiz' mode)
                if (appState.mode === 'quiz') {
                    saveQuizHistory();
                }
                appState.view = 'results';
            }
            render();
        }

        // --- 5. CORE LOGIC (Study Mode) ---

        function startStudySetup() {
            appState.view = 'studySetup';
            render();
        }

        function filterQuestions() {
            const chapterInputs = document.querySelectorAll('input[name="chapter"]:checked');
            const difficultyInputs = document.querySelectorAll('input[name="difficulty"]:checked');

            const selectedChapters = Array.from(chapterInputs).map(input => input.value);
            const selectedDifficulties = Array.from(difficultyInputs).map(input => parseInt(input.value));

            if (selectedChapters.length === 0 || selectedDifficulties.length === 0) {
                alert('Please select at least one Chapter and one Difficulty level.');
                return;
            }

            appState.currentQuestionList = questionsData
                .filter(q => selectedChapters.includes(q.chapter))
                .filter(q => selectedDifficulties.includes(q.difficulty))
                // Add the 'isRevealed' state for study mode
                .map(q => ({ ...q, isRevealed: false }));

            if (appState.currentQuestionList.length === 0) {
                 alert('No questions match the selected filters. Please adjust your selections.');
                 return;
            }

            appState.mode = 'study';
            appState.view = 'studyMode';
            render();
        }

        function toggleAnswer(questionId) {
            const index = appState.currentQuestionList.findIndex(q => q.id === questionId);
            if (index !== -1) {
                // Toggle the 'isRevealed' property
                appState.currentQuestionList[index].isRevealed = !appState.currentQuestionList[index].isRevealed;
                render();
            }
        }

        // --- 6. RENDER FUNCTIONS ---

        function renderHome() {
            const historyCount = appState.quizHistory.length;
            const trackingMessage = historyCount === 0 
                ? 'No history yet. Start quizzing!'
                : `Tracking the last ${historyCount} attempt${historyCount !== 1 ? 's' : ''} to improve variety.`;

            appContainer.innerHTML = `
                <div class="text-center space-y-8">
                    <h1 class="text-4xl font-extrabold text-blue-800">MGMT 290 Exam Review</h1>
                    <p class="text-lg text-gray-600">Chapters 1-11: Select a study mode to begin.</p>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 pt-6">
                        <div class="p-6 bg-blue-50 border-2 border-blue-200 rounded-lg space-y-4 shadow-lg transition duration-300 hover:shadow-xl hover:border-blue-400">
                            <h2 class="text-2xl font-bold text-blue-800">Test Mode</h2>
                            <p class="text-gray-600 text-sm">Answer all <span class="font-bold text-blue-600">110 questions</span> with immediate feedback.</p>
                            <button onclick="startMode('test')" class="w-full py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition duration-150 shadow-md">
                                Start Test Mode
                            </button>
                        </div>
                        <div class="p-6 bg-indigo-50 border-2 border-indigo-200 rounded-lg space-y-4 shadow-lg transition duration-300 hover:shadow-xl hover:border-indigo-400">
                            <h2 class="text-2xl font-bold text-indigo-800">Quiz Mode</h2>
                            <p class="text-gray-600 text-sm">Answer <span class="font-bold text-indigo-600">10 smart-selected questions</span> for a quick check.
                                <span class="block mt-2 text-xs text-gray-500 font-medium">
                                    ${trackingMessage}
                                </span>
                            </p>
                            <button onclick="startMode('quiz')" class="w-full py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition duration-150 shadow-md">
                                Start Quiz Mode
                            </button>
                        </div>
                        <div class="p-6 bg-green-50 border-2 border-green-200 rounded-lg space-y-4 shadow-lg transition duration-300 hover:shadow-xl hover:border-green-400">
                            <h2 class="text-2xl font-bold text-green-800">Study Mode</h2>
                            <p class="text-gray-600 text-sm">Filter by chapter/difficulty. Answers are hidden until revealed.</p>
                            <button onclick="startStudySetup()" class="w-full py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition duration-150 shadow-md">
                                Set Up Study
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderQuiz() {
            const currentQ = appState.currentQuestionList[appState.currentQuestionIndex];
            if (!currentQ) {
                appState.view = 'results';
                render();
                return;
            }

            const currentQNum = appState.currentQuestionIndex + 1;
            const totalQ = appState.currentQuestionList.length;
            const modeName = appState.mode === 'test' ? `Test Mode (All ${questionsData.length})` : 'Quiz Mode (10 Questions)';

            // Difficulty indicator colors
            let difficultyColor = 'bg-green-500';
            let difficultyText = 'Easy';
            if (currentQ.difficulty === 2) {
                difficultyColor = 'bg-yellow-500';
                difficultyText = 'Medium';
            } else if (currentQ.difficulty === 3) {
                difficultyColor = 'bg-red-500';
                difficultyText = 'Hard';
            }

            // Render options
            const optionsHTML = currentQ.options.map(option => {
                let classes = "w-full text-left py-3 px-4 rounded-lg border-2 cursor-pointer transition duration-150 ease-in-out font-medium ";
                let clickHandler = `checkAnswer('${option.replace(/'/g, "\\'")}')`; // Handle quotes in option text

                if (appState.isAnswered) {
                    // Answer has been selected, show results
                    clickHandler = ''; // Disable further clicks
                    if (option === appState.correctAnswer) {
                        // Correct answer
                        classes += "bg-green-100 border-green-500 text-green-800 shadow-md";
                    } else if (option === appState.selectedOption) {
                        // User's wrong answer
                        classes += "bg-red-100 border-red-500 text-red-800 shadow-md";
                    } else {
                        // Unselected wrong answer
                        classes += "bg-white border-gray-200 text-gray-600 opacity-60";
                    }
                } else {
                    // Not yet answered
                    classes += "bg-white border-gray-200 text-gray-700 hover:bg-blue-50 hover:border-blue-400";
                }

                return `<button onclick="${clickHandler}" class="${classes}">${option}</button>`;
            }).join('');

            // Feedback Section
            let feedbackHTML = '';
            if (appState.isAnswered) {
                const isCorrect = (appState.selectedOption === appState.correctAnswer);
                let messageClasses = isCorrect ? 'bg-green-100 text-green-800 border-green-400' : 'bg-red-100 text-red-800 border-red-400';

                feedbackHTML = `
                    <div class="mt-6 p-4 rounded-lg border-l-4 ${messageClasses}">
                        <p class="font-bold text-lg">${appState.feedbackMessage}</p>
                        ${!isCorrect ? `<p class="mt-2 text-md">The correct answer was: <span class="font-semibold">${appState.correctAnswer}</span></p>` : ''}
                    </div>
                    <div class="mt-6">
                        <button onclick="nextQuestion()" class="w-full py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition duration-150 shadow-md">
                            ${currentQNum < totalQ ? 'Next Question' : 'View Results'}
                        </button>
                    </div>
                `;
            }

            appContainer.innerHTML = `
                <div class="space-y-6">
                    <div class="flex justify-between items-center pb-4 border-b">
                        <h2 class="text-xl font-bold text-gray-700">${modeName}</h2>
                        <div class="text-2xl font-bold text-blue-600">
                            Q. ${currentQNum} / ${totalQ}
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div class="flex justify-between items-center text-sm text-gray-500">
                            <span>Chapter: <span class="font-semibold text-gray-800">${currentQ.chapter}</span></span>
                            <span class="px-3 py-1 text-xs font-semibold text-white rounded-full ${difficultyColor}">Difficulty: ${difficultyText}</span>
                        </div>

                        <p class="text-xl font-semibold text-gray-900 leading-relaxed">${currentQ.question}</p>
                    </div>

                    <div class="space-y-3 pt-4">
                        ${optionsHTML}
                    </div>

                    ${feedbackHTML}

                    <div class="pt-4 text-center">
                        <button onclick="appState.view = 'home'; render();" class="text-sm text-gray-500 hover:text-red-600 transition">
                            Exit ${appState.mode === 'test' ? 'Test' : 'Quiz'}
                        </button>
                    </div>
                </div>
            `;
        }

        function renderResults() {
            const totalQuestions = appState.currentQuestionList.length;
            const correctCount = appState.userAnswers.filter(a => a.correct).length;
            const scorePercentage = ((correctCount / totalQuestions) * 100).toFixed(0);
            const modeName = appState.mode === 'test' ? 'Test Mode' : 'Quiz Mode';

            // Grade assignment (simple scale)
            let grade = 'F';
            let gradeColor = 'text-red-600';
            if (scorePercentage >= 90) { grade = 'A'; gradeColor = 'text-green-600'; }
            else if (scorePercentage >= 80) { grade = 'B'; gradeColor = 'text-green-500'; }
            else if (scorePercentage >= 70) { grade = 'C'; gradeColor = 'text-yellow-500'; }
            else if (scorePercentage >= 60) { grade = 'D'; gradeColor = 'text-orange-500'; }


            const detailedResultsHTML = appState.userAnswers.map((answer, index) => {
                const q = appState.currentQuestionList[index];
                const icon = answer.correct
                    ? '<svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>'
                    : '<svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>';
                const resultText = answer.correct ? 'Correct' : 'Incorrect';
                const resultClasses = answer.correct ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200';

                return `
                    <div class="p-4 border rounded-lg ${resultClasses} mb-3">
                        <div class="flex items-start justify-between">
                            <p class="font-semibold text-gray-800">Q${index + 1}: ${q.question}</p>
                            <span class="flex items-center space-x-1 font-bold text-sm">
                                ${icon}
                                <span>${resultText}</span>
                            </span>
                        </div>
                        <p class="text-sm mt-2">Your Answer: <span class="${answer.correct ? 'font-semibold text-green-700' : 'font-semibold text-red-700'}">${answer.userAnswer}</span></p>
                        ${!answer.correct ? `<p class="text-sm">Correct Answer: <span class="font-semibold text-green-700">${q.correctAnswer}</span></p>` : ''}
                        <p class="text-xs text-gray-500 mt-1">${q.chapter} | Difficulty ${q.difficulty}</p>
                    </div>
                `;
            }).join('');


            appContainer.innerHTML = `
                <div class="space-y-8">
                    <h1 class="text-4xl font-extrabold text-blue-800 text-center">${modeName} Results</h1>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center p-4 bg-gray-50 rounded-xl shadow-inner border">
                        <div>
                            <p class="text-xl text-gray-500">Total Questions</p>
                            <p class="text-4xl font-bold text-gray-800">${totalQuestions}</p>
                        </div>
                        <div>
                            <p class="text-xl text-gray-500">Correct Answers</p>
                            <p class="text-4xl font-bold text-green-600">${correctCount}</p>
                        </div>
                        <div>
                            <p class="text-xl text-gray-500">Grade</p>
                            <p class="text-5xl font-extrabold ${gradeColor}">${grade} (${scorePercentage}%)</p>
                        </div>
                    </div>

                    <h2 class="text-2xl font-bold text-gray-700 border-b pb-2">Question-by-Question Review</h2>
                    <div class="max-h-[60vh] overflow-y-auto custom-scrollbar">
                        ${detailedResultsHTML}
                    </div>

                    <div class="text-center pt-4">
                        <button onclick="appState.view = 'home'; render();" class="py-3 px-8 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition duration-150 shadow-lg">
                            Return to Home
                        </button>
                    </div>
                </div>
            `;
        }

        function renderStudySetup() {
            const chapters = ['Chapter 1', 'Chapter 2', 'Chapter 3', 'Chapter 4', 'Chapter 5', 'Chapter 6', 'Chapter 7', 'Chapter 8', 'Chapter 9', 'Chapter 10', 'Chapter 11'];
            const difficulties = [
                { value: 1, label: '1 - Easy (Recall)', color: 'bg-green-500' },
                { value: 2, label: '2 - Medium (Application)', color: 'bg-yellow-500' },
                { value: 3, label: '3 - Hard (Synthesis)', color: 'bg-red-500' }
            ];

            const chapterChecks = chapters.map(chap => `
                <label class="flex items-center space-x-2 p-2 bg-gray-100 rounded-lg cursor-pointer hover:bg-gray-200 transition">
                    <input type="checkbox" name="chapter" value="${chap}" checked
                           class="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500">
                    <span class="text-gray-700 font-medium">${chap}</span>
                </label>
            `).join('');

            const difficultyChecks = difficulties.map(diff => `
                <label class="flex items-center space-x-2 p-2 bg-gray-100 rounded-lg cursor-pointer hover:bg-gray-200 transition">
                    <input type="checkbox" name="difficulty" value="${diff.value}" checked
                           class="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500">
                    <span class="text-gray-700 font-medium flex items-center">
                        ${diff.label}
                        <span class="w-2 h-2 ml-2 rounded-full ${diff.color}"></span>
                    </span>
                </label>
            `).join('');

            appContainer.innerHTML = `
                <div class="space-y-8">
                    <h1 class="text-3xl font-bold text-green-800 text-center border-b pb-4">Study Mode Setup</h1>
                    <p class="text-center text-gray-600">Select the specific chapters and difficulty levels you want to review.</p>

                    <div class="space-y-4">
                        <h2 class="text-xl font-semibold text-gray-700">Select Chapters</h2>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                            ${chapterChecks}
                        </div>
                    </div>

                    <div class="space-y-4">
                        <h2 class="text-xl font-semibold text-gray-700">Select Difficulty</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            ${difficultyChecks}
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4 pt-6">
                        <button onclick="appState.view = 'home'; render();"
                                class="w-full py-3 border border-gray-300 text-gray-700 font-semibold rounded-lg hover:bg-gray-100 transition duration-150">
                            Cancel
                        </button>
                        <button onclick="filterQuestions()"
                                class="w-full py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition duration-150 shadow-md">
                            Start Study Session
                        </button>
                    </div>
                </div>
            `;
        }

        function renderStudyMode() {
            const totalQ = appState.currentQuestionList.length;
            if (totalQ === 0) {
                appContainer.innerHTML = '<p class="text-center text-red-500 font-semibold">No questions matched your filters. Please return to setup.</p><div class="text-center pt-4"><button onclick="startStudySetup()" class="py-2 px-6 bg-green-600 text-white rounded-lg">Go to Setup</button></div>';
                return;
            }

            const questionsHTML = appState.currentQuestionList.map((q, index) => {
                const isRevealed = q.isRevealed;

                let difficultyColor = 'bg-green-500';
                if (q.difficulty === 2) difficultyColor = 'bg-yellow-500';
                if (q.difficulty === 3) difficultyColor = 'bg-red-500';
                
                const answerHTML = q.options.map(option => {
                    const isCorrect = option === q.correctAnswer;
                    let classes = "w-full text-left py-2 px-3 rounded-lg border transition duration-150 text-gray-700";
                    if (isCorrect) {
                        classes = "w-full text-left py-2 px-3 rounded-lg border-2 border-green-500 bg-green-100 text-green-800 font-bold transition duration-150";
                    }

                    return `<li class="${classes}">${option}</li>`;
                }).join('');

                return `
                    <div class="bg-white p-5 rounded-xl shadow-lg border border-gray-200 mb-6">
                        <div class="flex justify-between items-center mb-4 border-b pb-3">
                            <span class="text-xl font-bold text-gray-800">Question ${index + 1} / ${totalQ}</span>
                            <span class="px-3 py-1 text-xs font-semibold text-white rounded-full ${difficultyColor}">
                                D${q.difficulty} | ${q.chapter.replace('Chapter ', 'Ch ')}
                            </span>
                        </div>
                        
                        <p class="text-lg font-semibold text-gray-900 mb-4 leading-relaxed">${q.question}</p>

                        <button onclick="toggleAnswer(${q.id})"
                                class="w-full py-2 mb-4 font-semibold rounded-lg transition duration-150
                                ${isRevealed ? 'bg-red-500 hover:bg-red-600 text-white' : 'bg-green-200 hover:bg-green-300 text-green-800'}">
                            ${isRevealed ? 'Hide Answer' : 'Show Answer'}
                        </button>
                        
                        <div id="answer-section-${q.id}" class="${isRevealed ? '' : 'study-options-hidden'} pt-4 border-t border-gray-100">
                            <h3 class="text-md font-bold text-green-700 mb-3">Correct Solution:</h3>
                            <ul class="space-y-2">
                                ${answerHTML}
                            </ul>
                        </div>
                    </div>
                `;
            }).join('');

            appContainer.innerHTML = `
                <div class="space-y-6">
                    <h1 class="text-3xl font-bold text-green-800 text-center">Study Mode Session (${totalQ} Questions)</h1>
                    <div class="text-center pb-4">
                        <button onclick="startStudySetup()" class="py-2 px-6 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition duration-150">
                            Change Filters / Exit Study
                        </button>
                    </div>
                    
                    <div class="max-h-[70vh] overflow-y-auto custom-scrollbar p-1">
                        ${questionsHTML}
                    </div>
                </div>
            `;
        }


        // Main render function to control the view
        function render() {
            switch (appState.view) {
                case 'home':
                    renderHome();
                    break;
                case 'quiz':
                    renderQuiz();
                    break;
                case 'results':
                    renderResults();
                    break;
                case 'studySetup':
                    renderStudySetup();
                    break;
                case 'studyMode':
                    renderStudyMode();
                    break;
            }
            // Ensure the container is always centered
            appContainer.parentElement.scrollTop = 0;
        }

        // Initial call to start the application: Load history first, then render
        document.addEventListener('DOMContentLoaded', () => {
            initializeAppState(); 
            render();
        });
    </script>
</body>
</html>
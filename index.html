<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIS 245 Exam 2 Review</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Custom scrollbar for better feel */
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #a8a8a8;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f0f0f0; }

        /* Hide the options list initially in Study Mode */
        .study-options-hidden { display: none; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 md:p-8 flex items-center justify-center">

    <div id="app" class="w-full max-w-4xl bg-white shadow-2xl rounded-xl p-6 md:p-10 border border-gray-100 transition-all duration-500">
        <!-- Content will be rendered here by JavaScript -->
    </div>

    <script>
        // --- 1. DATA STRUCTURE: 62 Questions ---

        // Difficulty ranking: 1 (Easy: Definition/Recall), 2 (Medium: Application/Concept), 3 (Hard: Synthesis/Detailed Recall)
        const questionsData = [
            // Chapter 5: IT Infrastructure and Emerging Technologies (15 Qs)
            { id: 1, chapter: "Chapter 5", difficulty: 1, question: "Which term refers to the set of physical devices and software required to operate the enterprise?", options: ["A) Data Center", "B) IT Infrastructure", "C) Cloud Computing", "D) Operating System"], correctAnswer: "B) IT Infrastructure" },
            { id: 2, chapter: "Chapter 5", difficulty: 2, question: "What is the primary function of a server in IT infrastructure?", options: ["A) Manage network traffic", "B) Provide software services and resources to clients", "C) Display data to end-users", "D) Store data locally on a desktop"], correctAnswer: "B) Provide software services and resources to clients" },
            { id: 3, chapter: "Chapter 5", difficulty: 3, question: "The process of running a single physical server as multiple virtual 'machines' is known as:", options: ["A) Utility Computing", "B) Grid Computing", "C) Virtualization", "D) Multicore Processing"], correctAnswer: "C) Virtualization" },
            { id: 4, chapter: "Chapter 5", difficulty: 1, question: "What is Linux?", options: ["A) A programming language", "B) A type of server hardware", "C) An operating system", "D) A database management system"], correctAnswer: "C) An operating system" },
            { id: 5, chapter: "Chapter 5", difficulty: 2, question: "What is a 'legacy system'?", options: ["A) A system designed for future growth", "B) An outdated system that is difficult to replace", "C) A modern system using new technology", "D) A system built using open-source software"], correctAnswer: "B) An outdated system that is difficult to replace" },
            { id: 6, chapter: "Chapter 5", difficulty: 3, question: "The concept where firms pay only for the computing capacity they actually use is called:", options: ["A) Edge Computing", "B) Scalable Processing", "C) Utility Computing", "D) Quantum Computing"], correctAnswer: "C) Utility Computing" },
            { id: 7, chapter: "Chapter 5", difficulty: 1, question: "What does SaaS stand for in Cloud Computing?", options: ["A) System as a Service", "B) Software and a System", "C) Service at a Server", "D) Software as a Service"], correctAnswer: "D) Software as a Service" },
            { id: 8, chapter: "Chapter 5", difficulty: 2, question: "Which of the following cloud models provides a shared infrastructure for a specific community of organizations?", options: ["A) Public Cloud", "B) Private Cloud", "C) Hybrid Cloud", "D) Community Cloud"], correctAnswer: "D) Community Cloud" },
            { id: 9, chapter: "Chapter 5", difficulty: 3, question: "The 'Internet of Things' (IoT) is primarily based on which technological advancement?", options: ["A) Higher server density", "B) Low-cost processors and wireless networks", "C) Development of machine learning algorithms", "D) Mainframe modernization"], correctAnswer: "B) Low-cost processors and wireless networks" },
            { id: 10, chapter: "Chapter 5", difficulty: 1, question: "What is a major benefit of open-source software?", options: ["A) Restricted access to source code", "B) High licensing fees", "C) Flexibility and no reliance on a single vendor", "D) Proprietary formats only"], correctAnswer: "C) Flexibility and no reliance on a single vendor" },
            { id: 11, chapter: "Chapter 5", difficulty: 2, question: "Which IT infrastructure component manages and stores corporate data?", options: ["A) Telecommunications platforms", "B) Data management and storage", "C) Operating systems", "D) Application software"], correctAnswer: "B) Data management and storage" },
            { id: 12, chapter: "Chapter 5", difficulty: 3, question: "What architectural approach is most often used to deliver services and functionality between different applications?", options: ["A) Client-Server model", "B) Centralized processing", "C) Service-Oriented Architecture (SOA)", "D) Peer-to-Peer networking"], correctAnswer: "C) Service-Oriented Architecture (SOA)" },
            { id: 13, chapter: "Chapter 5", difficulty: 1, question: "TRUE or FALSE: Web services use XML and other protocols to link applications from different sources.", options: ["TRUE", "FALSE"], correctAnswer: "TRUE" },
            { id: 14, chapter: "Chapter 5", difficulty: 2, question: "The major challenge of managing IT infrastructure investment is:", options: ["A) Determining the optimal hardware vendor", "B) Calculating the Total Cost of Ownership (TCO)", "C) Hiring skilled programmers", "D) Choosing the right programming language"], correctAnswer: "B) Calculating the Total Cost of Ownership (TCO)" },
            { id: 15, chapter: "Chapter 5", difficulty: 1, question: "What is an application software package?", options: ["A) System software for managing the computer", "B) Software for performing a specific task or process", "C) The physical hardware of the computer", "D) A networking protocol"], correctAnswer: "B) Software for performing a specific task or process" },

            // Chapter 6: Databases and Information Management (16 Qs)
            { id: 16, chapter: "Chapter 6", difficulty: 1, question: "A collection of data organized to serve many applications efficiently is called a:", options: ["A) Spreadsheet", "B) Database", "C) Data Warehouse", "D) Data Mart"], correctAnswer: "B) Database" },
            { id: 17, chapter: "Chapter 6", difficulty: 2, question: "What primary problem does a Database Management System (DBMS) help solve?", options: ["A) Lack of internet connectivity", "B) Data redundancy and inconsistency", "C) Software licensing issues", "D) Slow processing speeds"], correctAnswer: "B) Data redundancy and inconsistency" },
            { id: 18, chapter: "Chapter 6", difficulty: 3, question: "What is the most popular type of database today?", options: ["A) Hierarchical", "B) Network", "C) Relational", "D) Object-Oriented"], correctAnswer: "C) Relational" },
            { id: 19, chapter: "Chapter 6", difficulty: 1, question: "A 'field' in a relational database represents a(n):", options: ["A) File", "B) Record", "C) Attribute", "D) Table"], correctAnswer: "C) Attribute" },
            { id: 20, chapter: "Chapter 6", difficulty: 2, question: "What unique identifier is used to link tables in a relational database?", options: ["A) Primary Key", "B) Foreign Key", "C) Secondary Key", "D) Compound Key"], correctAnswer: "B) Foreign Key" },
            { id: 21, chapter: "Chapter 6", difficulty: 3, question: "SQL stands for:", options: ["A) System Query Language", "B) Sequential Query Logic", "C) Structured Query Language", "D) Standard Quality Level"], correctAnswer: "C) Structured Query Language" },
            { id: 22, chapter: "Chapter 6", difficulty: 1, question: "What process identifies and removes inconsistencies in data?", options: ["A) Data mining", "B) Data governance", "C) Data cleansing", "D) Data warehousing"], correctAnswer: "C) Data cleansing" },
            { id: 23, chapter: "Chapter 6", difficulty: 2, question: "A data warehouse stores current and historical data of potential interest to decision-makers. (TRUE/FALSE)", options: ["TRUE", "FALSE"], correctAnswer: "TRUE" },
            { id: 24, chapter: "Chapter 6", difficulty: 3, question: "What is the process of finding patterns and rules from large data sets?", options: ["A) OLAP (Online Analytical Processing)", "B) Data Mining", "C) Data Definition Language", "D) Normalization"], correctAnswer: "B) Data Mining" },
            { id: 25, chapter: "Chapter 6", difficulty: 1, question: "Which type of database is best suited for storing vast amounts of unstructured or semi-structured data (like web content)?", options: ["A) Relational", "B) Non-Relational (NoSQL)", "C) Hierarchical", "D) Network"], correctAnswer: "B) Non-Relational (NoSQL)" },
            { id: 26, chapter: "Chapter 6", difficulty: 2, question: "What is the term for a subset of a data warehouse focused on a single function or subject area?", options: ["A) Data Cube", "B) Data Mart", "C) Data Cluster", "D) Data Lake"], correctAnswer: "B) Data Mart" },
            { id: 27, chapter: "Chapter 6", difficulty: 3, question: "What is 'Normalization' in database design?", options: ["A) The process of standardizing data entry forms", "B) Streamlining complex data groups to minimize redundancy", "C) Ensuring all data is of the same type", "D) Storing all related data in a single table"], correctAnswer: "B) Streamlining complex data groups to minimize redundancy" },
            { id: 28, chapter: "Chapter 6", difficulty: 1, question: "The logical view of data ________.", options: ["A) deals with the physical storage of the data", "B) presents data as end-users or business specialists see it", "C) is concerned with hardware efficiency", "D) is the same as the physical view"], correctAnswer: "B) presents data as end-users or business specialists see it" },
            { id: 29, chapter: "Chapter 6", difficulty: 2, question: "What key feature allows OLAP to rapidly analyze multidimensional data?", options: ["A) Join operations", "B) Pivot tables/Data Cubes", "C) Data definition language", "D) Data cleansing tools"], correctAnswer: "B) Pivot tables/Data Cubes" },
            { id: 30, chapter: "Chapter 6", difficulty: 3, question: "The ability to ensure that relationships between coupled tables remain consistent is referred to as:", options: ["A) Data mining", "B) Referential Integrity", "C) Normalization", "D) Data centralization"], correctAnswer: "B) Referential Integrity" },
            { id: 31, chapter: "Chapter 6", difficulty: 1, question: "What is a 'record' in a relational database?", options: ["A) An attribute", "B) A file", "C) A row in a table", "D) A unique key"], correctAnswer: "C) A row in a table" },

            // Chapter 7: Telecommunications, the Internet, and Wireless Technology (16 Qs)
            { id: 32, chapter: "Chapter 7", difficulty: 1, question: "The primary worldwide standard for communication among computers is:", options: ["A) HTTP", "B) HTML", "C) TCP/IP", "D) FTP"], correctAnswer: "C) TCP/IP" },
            { id: 33, chapter: "Chapter 7", difficulty: 2, question: "A local area network (LAN) is typically used to connect personal computers and digital devices within a ________.", options: ["A) Region", "B) Metropolitan area", "C) Geographically dispersed area", "D) Limited area, like an office or floor"], correctAnswer: "D) Limited area, like an office or floor" },
            { id: 34, chapter: "Chapter 7", difficulty: 3, question: "What is the function of a 'router' on a network?", options: ["A) Amplify signals", "B) Connect different network segments and choose the best path for data packets", "C) Create a wireless access point", "D) Convert analog signals to digital"], correctAnswer: "B) Connect different network segments and choose the best path for data packets" },
            { id: 35, chapter: "Chapter 7", difficulty: 1, question: "What addressing system uniquely identifies every computer on the Internet?", options: ["A) MAC Address", "B) HTML Address", "C) IP Address", "D) URL Address"], correctAnswer: "C) IP Address" },
            { id: 36, chapter: "Chapter 7", difficulty: 2, question: "The process of slicing digital messages into parcels and routing them independently to their destination is called:", options: ["A) Broadband", "B) Packet Switching", "C) URL Formatting", "D) Digital Signal Processing"], correctAnswer: "B) Packet Switching" },
            { id: 37, chapter: "Chapter 7", difficulty: 3, question: "What is the difference between an Intranet and an Extranet?", options: ["A) Intranets are public; Extranets are private.", "B) Intranets are private networks for internal use; Extranets allow authorized external users access.", "C) Intranets use TCP/IP; Extranets use a different protocol.", "D) They are the same thing."], correctAnswer: "B) Intranets are private networks for internal use; Extranets allow authorized external users access." },
            { id: 38, chapter: "Chapter 7", difficulty: 1, question: "What is a characteristic of a Wide Area Network (WAN)?", options: ["A) Limited to 10 users", "B) Spans a large geographical area", "C) Uses only wireless technology", "D) Connects only two computers"], correctAnswer: "B) Spans a large geographical area" },
            { id: 39, chapter: "Chapter 7", difficulty: 2, question: "What technology allows a phone to transfer digital data over existing analog telephone lines?", options: ["A) VPN", "B) Satellite", "C) DSL", "D) WiMAX"], correctAnswer: "C) DSL" },
            { id: 40, chapter: "Chapter 7", difficulty: 3, question: "A Domain Name System (DNS) server is responsible for:", options: ["A) Managing network security", "B) Converting domain names to IP addresses", "C) Routing data packets on the Internet", "D) Providing email services"], correctAnswer: "B) Converting domain names to IP addresses" },
            { id: 41, chapter: "Chapter 7", difficulty: 1, question: "What is the standard for wireless fidelity?", options: ["A) 4G", "B) Bluetooth", "C) Wi-Fi", "D) RFID"], correctAnswer: "C) Wi-Fi" },
            { id: 42, chapter: "Chapter 7", difficulty: 2, question: "Which wireless technology is suitable for creating a small, personal area network (PAN)?", options: ["A) WiMAX", "B) Cellular", "C) Bluetooth", "D) Satellite"], correctAnswer: "C) Bluetooth" },
            { id: 43, chapter: "Chapter 7", difficulty: 3, question: "Which generation of cellular network technology is designed to support the 'Internet of Things' and massive device connectivity?", options: ["A) 3G", "B) 4G", "C) 5G", "D) 2G"], correctAnswer: "C) 5G" },
            { id: 44, chapter: "Chapter 7", difficulty: 1, question: "TRUE or FALSE: Fiber-optic cable transmits data as pulses of light, which makes it faster and less subject to interference than copper wire.", options: ["TRUE", "FALSE"], correctAnswer: "TRUE" },
            { id: 45, chapter: "Chapter 7", difficulty: 2, question: "What is the term for a web page that allows users to collaboratively modify its content and structure?", options: ["A) Blog", "B) Podcast", "C) Wiki", "D) RSS Feed"], correctAnswer: "C) Wiki" },
            { id: 46, chapter: "Chapter 7", difficulty: 3, question: "The 'Caves' and 'Plains' of the Web refer to:", options: ["A) Dark Web vs Surface Web", "B) Areas where censorship is high or low", "C) The physical vs. logical structure of the Internet", "D) Private social networks vs. public ones"], correctAnswer: "D) Private social networks vs. public ones" },
            { id: 47, chapter: "Chapter 7", difficulty: 1, question: "What is the primary language used to create web pages?", options: ["A) Java", "B) Python", "C) HTML", "D) SQL"], correctAnswer: "C) HTML" },

            // Chapter 8: Security and Control (15 Qs)
            { id: 48, chapter: "Chapter 8", difficulty: 1, question: "Which of the following refers to policies, procedures, and technical measures used to prevent unauthorized access, alteration, theft, or physical damage to information systems?", options: ["A) Security", "B) Controls", "C) Benchmarking", "D) Algorithms"], correctAnswer: "A) Security" },
            { id: 49, chapter: "Chapter 8", difficulty: 2, question: "TRUE or FALSE: Legislation requiring private or governmental entities to notify individuals of security breaches involving personally identifiable information has been enacted in all 50 states.", options: ["TRUE", "FALSE"], correctAnswer: "TRUE" },
            { id: 50, chapter: "Chapter 8", difficulty: 2, question: "TRUE or FALSE: Zero defects cannot be achieved in larger software programs because fully testing programs that contain thousands of choices and millions of paths would require thousands of years. (TRUE/FALSE)", options: ["TRUE", "FALSE"], correctAnswer: "TRUE" },
            { id: 51, chapter: "Chapter 8", difficulty: 1, question: "The Sarbanes-Oxley Act ________.", options: ["A) requires financial institutions to ensure the security of customer data", "B) specifies best practices in information systems security and control", "C) imposes responsibility on companies and management to safeguard the accuracy of financial information", "D) outlines medical security and privacy rules"], correctAnswer: "C) imposes responsibility on companies and management to safeguard the accuracy of financial information" },
            { id: 52, chapter: "Chapter 8", difficulty: 2, question: "What is a 'Trojan Horse' in the context of security?", options: ["A) A program that claims to be benign but does something malicious", "B) A virus that replicates itself across networks", "C) A hardware device used for sniffing traffic", "D) A type of firewall"], correctAnswer: "A) A program that claims to be benign but does something malicious" },
            { id: 53, chapter: "Chapter 8", difficulty: 3, question: "A Denial-of-Service (DoS) attack is successful because it:", options: ["A) Steals user passwords", "B) Overloads a network server with too many requests", "C) Installs spyware on a client computer", "D) Physically damages the server hardware"], correctAnswer: "B) Overloads a network server with too many requests" },
            { id: 54, chapter: "Chapter 8", difficulty: 1, question: "HIPAA outlines medical security and privacy rules. (TRUE/FALSE)", options: ["TRUE", "FALSE"], correctAnswer: "TRUE" },
            { id: 55, chapter: "Chapter 8", difficulty: 2, question: "What type of software tracks a user's web browsing and uses the data for marketing purposes?", options: ["A) Ransomware", "B) Spyware", "C) Keylogger", "D) Phishing"], correctAnswer: "B) Spyware" },
            { id: 56, chapter: "Chapter 8", difficulty: 3, question: "In a business continuity plan, what is the process of setting up off-site storage for critical data and systems?", options: ["A) Auditing", "B) Disaster Recovery Planning", "C) Authentication", "D) System analysis"], correctAnswer: "B) Disaster Recovery Planning" },
            { id: 57, chapter: "Chapter 8", difficulty: 1, question: "A 'firewall' is primarily used to:", options: ["A) Boost internet speed", "B) Prevent unauthorized network access", "C) Organize email", "D) Manage database backups"], correctAnswer: "B) Prevent unauthorized network access" },
            { id: 58, chapter: "Chapter 8", difficulty: 2, question: "What is the term for verifying a user's identity, often with a password or biometric data?", options: ["A) Authorization", "B) Authentication", "C) Cryptography", "D) Integrity"], correctAnswer: "B) Authentication" },
            { id: 59, chapter: "Chapter 8", difficulty: 3, question: "Encryption is a process that:", options: ["A) Scrambles data into an unreadable form for transmission", "B) Scans a system for viruses", "C) Creates a backup of files", "D) Verifies the identity of a user"], correctAnswer: "A) Scrambles data into an unreadable form for transmission" },
            { id: 60, chapter: "Chapter 8", difficulty: 1, question: "What does a 'man-in-the-middle' attack involve?", options: ["A) Physically accessing a server", "B) Eavesdropping on communication between two parties", "C) Using stolen credit card numbers", "D) Deleting files remotely"], correctAnswer: "B) Eavesdropping on communication between two parties" },
            { id: 61, chapter: "Chapter 8", difficulty: 2, question: "What is a major advantage of using a VPN (Virtual Private Network)?", options: ["A) It automatically updates software.", "B) It creates a secure, encrypted tunnel over a public network.", "C) It provides faster connection speeds than a dedicated line.", "D) It eliminates the need for user passwords."], correctAnswer: "B) It creates a secure, encrypted tunnel over a public network." },
            { id: 62, chapter: "Chapter 8", difficulty: 3, question: "Which control is intended to ensure that data is not altered or destroyed in an unauthorized manner, maintaining data quality?", options: ["A) Availability", "B) Confidentiality", "C) Integrity", "D) Auditing"], correctAnswer: "C) Integrity" },
        ];


        // --- 2. APP STATE MANAGEMENT ---
        let appState = {
            view: 'home', // 'home', 'quiz', 'results', 'studySetup', 'studyMode'
            mode: null, // 'test', 'quiz', or 'study'
            currentQuestionIndex: 0,
            currentQuestionList: [],
            userAnswers: [],
            feedbackMessage: null,
            correctAnswer: null,
            selectedOption: null,
            isAnswered: false,
            // New state for Study Mode filters
            studyFilters: {
                chapters: ['Chapter 5', 'Chapter 6', 'Chapter 7', 'Chapter 8'],
                difficulties: [1, 2, 3]
            },
            // NEW: History of the last quiz's question IDs to prevent immediate repeats
            recentlyUsedQuizIds: [],
        };

        const appContainer = document.getElementById('app');

        // --- 3. HELPER FUNCTIONS ---

        // Utility to shuffle an array (used for Quiz Mode)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // --- 4. CORE LOGIC (Test/Quiz Modes) ---

        function startMode(mode) {
            appState.mode = mode;
            appState.userAnswers = [];
            appState.currentQuestionIndex = 0;
            appState.feedbackMessage = null;
            appState.correctAnswer = null;
            appState.selectedOption = null;
            appState.isAnswered = false;

            if (mode === 'test') {
                appState.currentQuestionList = [...questionsData];
                shuffleArray(appState.currentQuestionList);
            } else if (mode === 'quiz') {
                const QUIZ_SIZE = 10;
                
                // 1. Separate questions into 'unseen' and 'seen' based on history
                const unseenQuestions = questionsData.filter(q => !appState.recentlyUsedQuizIds.includes(q.id));
                const seenQuestions = questionsData.filter(q => appState.recentlyUsedQuizIds.includes(q.id));

                // 2. Shuffle both pools
                shuffleArray(unseenQuestions);
                shuffleArray(seenQuestions);

                // 3. Prioritize 'unseen' questions
                let selectedQuestions = [];
                
                // Take as many 'unseen' questions as available, up to QUIZ_SIZE
                const unseenToTake = Math.min(unseenQuestions.length, QUIZ_SIZE);
                selectedQuestions.push(...unseenQuestions.slice(0, unseenToTake));

                // 4. Fill remaining slots with 'seen' questions if necessary
                const remainingSlots = QUIZ_SIZE - selectedQuestions.length;
                if (remainingSlots > 0) {
                    selectedQuestions.push(...seenQuestions.slice(0, remainingSlots));
                }

                // 5. Final check (should always be QUIZ_SIZE or less) and shuffle for good measure
                shuffleArray(selectedQuestions);
                appState.currentQuestionList = selectedQuestions;

            }

            appState.view = 'quiz'; // Reusing the quiz view for test/quiz mode
            render();
        }

        function checkAnswer(selectedOption) {
            if (appState.isAnswered) return; // Prevent double answering

            const currentQ = appState.currentQuestionList[appState.currentQuestionIndex];
            const isCorrect = (selectedOption === currentQ.correctAnswer);

            appState.selectedOption = selectedOption;
            appState.correctAnswer = currentQ.correctAnswer;
            appState.isAnswered = true;

            if (isCorrect) {
                appState.feedbackMessage = "Correct!";
            } else {
                appState.feedbackMessage = "Incorrect. The correct answer is:";
            }

            // Record the answer for final grading
            appState.userAnswers.push({
                questionId: currentQ.id,
                userAnswer: selectedOption,
                correct: isCorrect
            });

            render();
        }

        function nextQuestion() {
            if (!appState.isAnswered) {
                return;
            }

            appState.currentQuestionIndex++;
            appState.feedbackMessage = null;
            appState.correctAnswer = null;
            appState.selectedOption = null;
            appState.isAnswered = false;

            if (appState.currentQuestionIndex >= appState.currentQuestionList.length) {
                // Update history if it was a quiz mode before showing results
                if (appState.mode === 'quiz') {
                    appState.recentlyUsedQuizIds = appState.currentQuestionList.map(q => q.id);
                }
                appState.view = 'results';
            }
            render();
        }

        // --- 5. CORE LOGIC (Study Mode) ---

        function startStudySetup() {
            appState.view = 'studySetup';
            render();
        }

        function filterQuestions() {
            const chapterInputs = document.querySelectorAll('input[name="chapter"]:checked');
            const difficultyInputs = document.querySelectorAll('input[name="difficulty"]:checked');

            const selectedChapters = Array.from(chapterInputs).map(input => input.value);
            const selectedDifficulties = Array.from(difficultyInputs).map(input => parseInt(input.value));

            if (selectedChapters.length === 0 || selectedDifficulties.length === 0) {
                alert('Please select at least one Chapter and one Difficulty level.');
                return;
            }

            appState.currentQuestionList = questionsData
                .filter(q => selectedChapters.includes(q.chapter))
                .filter(q => selectedDifficulties.includes(q.difficulty))
                // Add the 'isRevealed' state for study mode
                .map(q => ({ ...q, isRevealed: false }));

            if (appState.currentQuestionList.length === 0) {
                 alert('No questions match the selected filters. Please adjust your selections.');
                 return;
            }

            appState.mode = 'study';
            appState.view = 'studyMode';
            render();
        }

        function toggleAnswer(questionId) {
            const index = appState.currentQuestionList.findIndex(q => q.id === questionId);
            if (index !== -1) {
                // Toggle the 'isRevealed' property
                appState.currentQuestionList[index].isRevealed = !appState.currentQuestionList[index].isRevealed;
                render();
            }
        }

        // --- 6. RENDER FUNCTIONS ---

        function renderHome() {
            appContainer.innerHTML = `
                <div class="text-center space-y-8">
                    <h1 class="text-4xl font-extrabold text-blue-800">MIS 245 Exam 2 Review</h1>
                    <p class="text-lg text-gray-600">Chapters 5-8: Select a study mode to begin.</p>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 pt-6">
                        <!-- Test Mode -->
                        <div class="p-6 bg-blue-50 border-2 border-blue-200 rounded-lg space-y-4 shadow-lg transition duration-300 hover:shadow-xl hover:border-blue-400">
                            <h2 class="text-2xl font-bold text-blue-800">Test Mode</h2>
                            <p class="text-gray-600 text-sm">Answer all <span class="font-bold text-blue-600">62 questions</span> with immediate feedback.</p>
                            <button onclick="startMode('test')" class="w-full py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition duration-150 shadow-md">
                                Start Test Mode
                            </button>
                        </div>
                        <!-- Quiz Mode (Improved Selection) -->
                        <div class="p-6 bg-indigo-50 border-2 border-indigo-200 rounded-lg space-y-4 shadow-lg transition duration-300 hover:shadow-xl hover:border-indigo-400">
                            <h2 class="text-2xl font-bold text-indigo-800">Quiz Mode</h2>
                            <p class="text-gray-600 text-sm">Answer <span class="font-bold text-indigo-600">10 smart-selected questions</span> for a quick check.</p>
                            <button onclick="startMode('quiz')" class="w-full py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition duration-150 shadow-md">
                                Start Quiz Mode
                            </button>
                        </div>
                        <!-- New Study Mode -->
                        <div class="p-6 bg-green-50 border-2 border-green-200 rounded-lg space-y-4 shadow-lg transition duration-300 hover:shadow-xl hover:border-green-400">
                            <h2 class="text-2xl font-bold text-green-800">Study Mode</h2>
                            <p class="text-gray-600 text-sm">Filter by chapter/difficulty. Answers are hidden until revealed.</p>
                            <button onclick="startStudySetup()" class="w-full py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition duration-150 shadow-md">
                                Set Up Study
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderQuiz() {
            const currentQ = appState.currentQuestionList[appState.currentQuestionIndex];
            if (!currentQ) {
                appState.view = 'results';
                render();
                return;
            }

            const currentQNum = appState.currentQuestionIndex + 1;
            const totalQ = appState.currentQuestionList.length;
            const modeName = appState.mode === 'test' ? 'Test Mode (All 62)' : 'Quiz Mode (10 Questions)';

            // Difficulty indicator colors
            let difficultyColor = 'bg-green-500';
            let difficultyText = 'Easy';
            if (currentQ.difficulty === 2) {
                difficultyColor = 'bg-yellow-500';
                difficultyText = 'Medium';
            } else if (currentQ.difficulty === 3) {
                difficultyColor = 'bg-red-500';
                difficultyText = 'Hard';
            }

            // Render options
            const optionsHTML = currentQ.options.map(option => {
                let classes = "w-full text-left py-3 px-4 rounded-lg border-2 cursor-pointer transition duration-150 ease-in-out font-medium ";
                let clickHandler = `checkAnswer('${option.replace(/'/g, "\\'")}')`; // Handle quotes in option text

                if (appState.isAnswered) {
                    // Answer has been selected, show results
                    clickHandler = ''; // Disable further clicks
                    if (option === appState.correctAnswer) {
                        // Correct answer
                        classes += "bg-green-100 border-green-500 text-green-800 shadow-md";
                    } else if (option === appState.selectedOption) {
                        // User's wrong answer
                        classes += "bg-red-100 border-red-500 text-red-800 shadow-md";
                    } else {
                        // Unselected wrong answer
                        classes += "bg-white border-gray-200 text-gray-600 opacity-60";
                    }
                } else {
                    // Not yet answered
                    classes += "bg-white border-gray-200 text-gray-700 hover:bg-blue-50 hover:border-blue-400";
                }

                return `<button onclick="${clickHandler}" class="${classes}">${option}</button>`;
            }).join('');

            // Feedback Section
            let feedbackHTML = '';
            if (appState.isAnswered) {
                const isCorrect = (appState.selectedOption === appState.correctAnswer);
                let messageClasses = isCorrect ? 'bg-green-100 text-green-800 border-green-400' : 'bg-red-100 text-red-800 border-red-400';

                feedbackHTML = `
                    <div class="mt-6 p-4 rounded-lg border-l-4 ${messageClasses}">
                        <p class="font-bold text-lg">${appState.feedbackMessage}</p>
                        ${!isCorrect ? `<p class="mt-2 text-md">The correct answer was: <span class="font-semibold">${appState.correctAnswer}</span></p>` : ''}
                    </div>
                    <div class="mt-6">
                        <button onclick="nextQuestion()" class="w-full py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition duration-150 shadow-md">
                            ${currentQNum < totalQ ? 'Next Question' : 'View Results'}
                        </button>
                    </div>
                `;
            }

            appContainer.innerHTML = `
                <div class="space-y-6">
                    <div class="flex justify-between items-center pb-4 border-b">
                        <h2 class="text-xl font-bold text-gray-700">${modeName}</h2>
                        <div class="text-2xl font-bold text-blue-600">
                            Q. ${currentQNum} / ${totalQ}
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div class="flex justify-between items-center text-sm text-gray-500">
                            <span>Chapter: <span class="font-semibold text-gray-800">${currentQ.chapter}</span></span>
                            <span class="px-3 py-1 text-xs font-semibold text-white rounded-full ${difficultyColor}">Difficulty: ${difficultyText}</span>
                        </div>

                        <p class="text-2xl font-semibold text-gray-900 leading-relaxed">${currentQ.question}</p>
                    </div>

                    <div class="space-y-3 pt-4">
                        ${optionsHTML}
                    </div>

                    ${feedbackHTML}

                    <div class="pt-4 text-center">
                        <button onclick="appState.view = 'home'; render();" class="text-sm text-gray-500 hover:text-red-600 transition">
                            Exit ${appState.mode === 'test' ? 'Test' : 'Quiz'}
                        </button>
                    </div>
                </div>
            `;
        }

        function renderResults() {
            const totalQuestions = appState.currentQuestionList.length;
            const correctCount = appState.userAnswers.filter(a => a.correct).length;
            const scorePercentage = ((correctCount / totalQuestions) * 100).toFixed(0);
            const modeName = appState.mode === 'test' ? 'Test Mode' : 'Quiz Mode';

            // Grade assignment (simple scale)
            let grade = 'F';
            let gradeColor = 'text-red-600';
            if (scorePercentage >= 90) { grade = 'A'; gradeColor = 'text-green-600'; }
            else if (scorePercentage >= 80) { grade = 'B'; gradeColor = 'text-green-500'; }
            else if (scorePercentage >= 70) { grade = 'C'; gradeColor = 'text-yellow-500'; }
            else if (scorePercentage >= 60) { grade = 'D'; gradeColor = 'text-orange-500'; }


            const detailedResultsHTML = appState.userAnswers.map((answer, index) => {
                const q = appState.currentQuestionList[index];
                const icon = answer.correct
                    ? '<svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>'
                    : '<svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>';
                const resultText = answer.correct ? 'Correct' : 'Incorrect';
                const resultClasses = answer.correct ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200';

                return `
                    <div class="p-4 border rounded-lg ${resultClasses} mb-3">
                        <div class="flex items-start justify-between">
                            <p class="font-semibold text-gray-800">Q${index + 1}: ${q.question}</p>
                            <span class="flex items-center space-x-1 font-bold text-sm">
                                ${icon}
                                <span>${resultText}</span>
                            </span>
                        </div>
                        <p class="text-sm mt-2">Your Answer: <span class="${answer.correct ? 'font-semibold text-green-700' : 'font-semibold text-red-700'}">${answer.userAnswer}</span></p>
                        ${!answer.correct ? `<p class="text-sm">Correct Answer: <span class="font-semibold text-green-700">${q.correctAnswer}</span></p>` : ''}
                        <p class="text-xs text-gray-500 mt-1">Chapter ${q.chapter.replace('Chapter ', '')} | Difficulty ${q.difficulty}</p>
                    </div>
                `;
            }).join('');


            appContainer.innerHTML = `
                <div class="space-y-8">
                    <h1 class="text-4xl font-extrabold text-blue-800 text-center">${modeName} Results</h1>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center p-4 bg-gray-50 rounded-xl shadow-inner border">
                        <div>
                            <p class="text-xl text-gray-500">Total Questions</p>
                            <p class="text-4xl font-bold text-gray-800">${totalQuestions}</p>
                        </div>
                        <div>
                            <p class="text-xl text-gray-500">Correct Answers</p>
                            <p class="text-4xl font-bold text-green-600">${correctCount}</p>
                        </div>
                        <div>
                            <p class="text-xl text-gray-500">Grade</p>
                            <p class="text-5xl font-extrabold ${gradeColor}">${grade} (${scorePercentage}%)</p>
                        </div>
                    </div>

                    <h2 class="text-2xl font-bold text-gray-700 border-b pb-2">Question-by-Question Review</h2>
                    <div class="max-h-[60vh] overflow-y-auto custom-scrollbar">
                        ${detailedResultsHTML}
                    </div>

                    <div class="text-center pt-4">
                        <button onclick="appState.view = 'home'; render();" class="py-3 px-8 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition duration-150 shadow-lg">
                            Return to Home
                        </button>
                    </div>
                </div>
            `;
        }

        function renderStudySetup() {
            const chapters = ['Chapter 5', 'Chapter 6', 'Chapter 7', 'Chapter 8'];
            const difficulties = [
                { value: 1, label: '1 - Easy (Recall)', color: 'bg-green-500' },
                { value: 2, label: '2 - Medium (Application)', color: 'bg-yellow-500' },
                { value: 3, label: '3 - Hard (Synthesis)', color: 'bg-red-500' }
            ];

            const chapterChecks = chapters.map(chap => `
                <label class="flex items-center space-x-2 p-2 bg-gray-100 rounded-lg cursor-pointer hover:bg-gray-200 transition">
                    <input type="checkbox" name="chapter" value="${chap}" checked
                           class="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500">
                    <span class="text-gray-700 font-medium">${chap}</span>
                </label>
            `).join('');

            const difficultyChecks = difficulties.map(diff => `
                <label class="flex items-center space-x-2 p-2 bg-gray-100 rounded-lg cursor-pointer hover:bg-gray-200 transition">
                    <input type="checkbox" name="difficulty" value="${diff.value}" checked
                           class="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500">
                    <span class="text-gray-700 font-medium flex items-center">
                        ${diff.label}
                        <span class="w-2 h-2 ml-2 rounded-full ${diff.color}"></span>
                    </span>
                </label>
            `).join('');

            appContainer.innerHTML = `
                <div class="space-y-8">
                    <h1 class="text-3xl font-bold text-green-800 text-center border-b pb-4">Study Mode Setup</h1>
                    <p class="text-center text-gray-600">Select the specific chapters and difficulty levels you want to review.</p>

                    <!-- Chapter Filter -->
                    <div class="space-y-4">
                        <h2 class="text-xl font-semibold text-gray-700">Select Chapters</h2>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            ${chapterChecks}
                        </div>
                    </div>

                    <!-- Difficulty Filter -->
                    <div class="space-y-4">
                        <h2 class="text-xl font-semibold text-gray-700">Select Difficulty</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            ${difficultyChecks}
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4 pt-6">
                        <button onclick="appState.view = 'home'; render();"
                                class="w-full py-3 border border-gray-300 text-gray-700 font-semibold rounded-lg hover:bg-gray-100 transition duration-150">
                            Cancel
                        </button>
                        <button onclick="filterQuestions()"
                                class="w-full py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition duration-150 shadow-md">
                            Start Study Session
                        </button>
                    </div>
                </div>
            `;
        }

        function renderStudyMode() {
            const totalQ = appState.currentQuestionList.length;
            if (totalQ === 0) {
                appContainer.innerHTML = '<p class="text-center text-red-500 font-semibold">No questions matched your filters. Please return to setup.</p><div class="text-center pt-4"><button onclick="startStudySetup()" class="py-2 px-6 bg-green-600 text-white rounded-lg">Go to Setup</button></div>';
                return;
            }

            const questionsHTML = appState.currentQuestionList.map((q, index) => {
                const isRevealed = q.isRevealed;

                let difficultyColor = 'bg-green-500';
                if (q.difficulty === 2) difficultyColor = 'bg-yellow-500';
                if (q.difficulty === 3) difficultyColor = 'bg-red-500';
                
                const answerHTML = q.options.map(option => {
                    const isCorrect = option === q.correctAnswer;
                    let classes = "w-full text-left py-2 px-3 rounded-lg border transition duration-150 text-gray-700";
                    if (isCorrect) {
                        classes = "w-full text-left py-2 px-3 rounded-lg border-2 border-green-500 bg-green-100 text-green-800 font-bold transition duration-150";
                    }

                    return `<li class="${classes}">${option}</li>`;
                }).join('');

                return `
                    <div class="bg-white p-5 rounded-xl shadow-lg border border-gray-200 mb-6">
                        <div class="flex justify-between items-center mb-4 border-b pb-3">
                            <span class="text-xl font-bold text-gray-800">Question ${index + 1} / ${totalQ}</span>
                            <span class="px-3 py-1 text-xs font-semibold text-white rounded-full ${difficultyColor}">
                                D${q.difficulty} | ${q.chapter.replace('Chapter ', 'Ch ')}
                            </span>
                        </div>
                        
                        <p class="text-lg font-semibold text-gray-900 mb-4 leading-relaxed">${q.question}</p>

                        <button onclick="toggleAnswer(${q.id})"
                                class="w-full py-2 mb-4 font-semibold rounded-lg transition duration-150
                                ${isRevealed ? 'bg-red-500 hover:bg-red-600 text-white' : 'bg-green-200 hover:bg-green-300 text-green-800'}">
                            ${isRevealed ? 'Hide Answer' : 'Show Answer'}
                        </button>
                        
                        <div id="answer-section-${q.id}" class="${isRevealed ? '' : 'study-options-hidden'} pt-4 border-t border-gray-100">
                            <h3 class="text-md font-bold text-green-700 mb-3">Correct Solution:</h3>
                            <ul class="space-y-2">
                                ${answerHTML}
                            </ul>
                        </div>
                    </div>
                `;
            }).join('');

            appContainer.innerHTML = `
                <div class="space-y-6">
                    <h1 class="text-3xl font-bold text-green-800 text-center">Study Mode Session (${totalQ} Questions)</h1>
                    <div class="text-center pb-4">
                        <button onclick="startStudySetup()" class="py-2 px-6 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition duration-150">
                            Change Filters / Exit Study
                        </button>
                    </div>
                    
                    <div class="max-h-[70vh] overflow-y-auto custom-scrollbar p-1">
                        ${questionsHTML}
                    </div>
                </div>
            `;
        }


        // Main render function to control the view
        function render() {
            switch (appState.view) {
                case 'home':
                    renderHome();
                    break;
                case 'quiz':
                    renderQuiz();
                    break;
                case 'results':
                    renderResults();
                    break;
                case 'studySetup':
                    renderStudySetup();
                    break;
                case 'studyMode':
                    renderStudyMode();
                    break;
            }
            // Ensure the container is always centered
            appContainer.parentElement.scrollTop = 0;
        }

        // Initial call to start the application
        document.addEventListener('DOMContentLoaded', render);
    </script>
</body>
</html>
